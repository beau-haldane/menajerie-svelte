import{s as V,n as S,o as Ft}from"../chunks/scheduler.e108d1fd.js";import{S as G,i as K,y as H,z as J,j as y,f as m,k as p,a as M,x as v,g as T,s as L,r as W,h as x,A as se,c as D,u as Y,v as Q,d as N,t as F,w as X,p as Ct,b as jt,B as qt,m as pe,n as ve,o as Oe}from"../chunks/index.894b1f91.js";import{_ as Le}from"../chunks/preload-helper.a4192956.js";function Bt(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function at(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}const zt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Le(()=>Promise.resolve().then(()=>De),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Qe extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Ht extends Qe{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Jt extends Qe{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Vt extends Qe{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Gt=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};class Kt{constructor(e,{headers:t={},customFetch:s}={}){this.url=e,this.headers=t,this.fetch=zt(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Gt(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:a}=t;let o={},l;a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const h=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:l}).catch(f=>{throw new Ht(f)}),c=h.headers.get("x-relay-error");if(c&&c==="true")throw new Jt(h);if(!h.ok)throw new Vt(h);let u=((s=h.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),d;return u==="application/json"?d=yield h.json():u==="application/octet-stream"?d=yield h.blob():u==="multipart/form-data"?d=yield h.formData():d=yield h.text(),{data:d,error:null}}catch(r){return{data:null,error:r}}})}}var ot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ve={exports:{}};(function(n,e){var t=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof ot<"u")return ot;throw new Error("unable to locate global object")},s=t();n.exports=e=s.fetch,s.fetch&&(e.default=s.fetch.bind(s)),e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response})(Ve,Ve.exports);var Xe=Ve.exports;const Ze=Wt(Xe),De=Bt({__proto__:null,default:Ze},[Xe]);class Yt{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ze:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let r=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,l;let h=null,c=null,u=null,d=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){const b=await i.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=b:c=JSON.parse(b))}const g=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),w=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");g&&w&&w.length>1&&(u=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(h={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,u=null,d=406,f="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const g=await i.text();try{h=JSON.parse(g),Array.isArray(h)&&i.status===404&&(c=[],h=null,d=200,f="OK")}catch{i.status===404&&g===""?(d=204,f="No Content"):h={message:g}}if(h&&this.isMaybeSingle&&(!((l=h==null?void 0:h.details)===null||l===void 0)&&l.includes("Results contain 0 rows"))&&(h=null,d=200,f="OK"),h&&this.shouldThrowOnError)throw h}return{error:h,data:c,count:u,status:d,statusText:f}});return this.shouldThrowOnError||(r=r.catch(i=>{var a,o,l;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}}class Qt extends Yt{select(e){let t=!1;const s=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r}={}){const i=r?`${r}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const s=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:s}={}){const r=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:a="text"}={}){const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class ge extends Qt{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=t.map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t}={}){const s=t?`${t}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}class Xt{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new ge({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new ge({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),r&&o.push(`count=${r}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((h,c)=>h.concat(Object.keys(c)),[]);if(l.length>0){const h=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",h.join(","))}}return new ge({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new ge({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new ge({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Zt="1.8.4",es={"X-Client-Info":`postgrest-js/${Zt}`};class et{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},es),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new Xt(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new et(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,count:r}={}){let i;const a=new URL(`${this.url}/rpc/${e}`);let o;s?(i="HEAD",Object.entries(t).forEach(([h,c])=>{a.searchParams.append(h,`${c}`)})):(i="POST",o=t);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new ge({method:i,url:a,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}var Me,lt;function ts(){if(lt)return Me;lt=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return Me=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),Me}const ss="websocket",rs="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",is=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],ns="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",as=["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],os="1.0.34",ls={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},cs="https://github.com/theturtle32/WebSocket-Node",hs={node:">=4.0.0"},us={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},ds={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},fs={verbose:!1},gs={test:"tape test/unit/*.js",gulp:"gulp"},ps="index",vs={lib:"./lib"},ms="lib/browser.js",_s="Apache-2.0",ws={name:ss,description:rs,keywords:is,author:ns,contributors:as,version:os,repository:ls,homepage:cs,engines:hs,dependencies:us,devDependencies:ds,config:fs,scripts:gs,main:ps,directories:vs,browser:ms,license:_s};var bs=ws.version,ce;if(typeof globalThis=="object")ce=globalThis;else try{ce=ts()}catch{}finally{if(!ce&&typeof window<"u"&&(ce=window),!ce)throw new Error("Could not determine global this")}var Ce=ce.WebSocket||ce.MozWebSocket,ys=bs;function At(n,e){var t;return e?t=new Ce(n,e):t=new Ce(n),t}Ce&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(At,n,{get:function(){return Ce[n]}})});var $s={w3cwebsocket:Ce?At:null,version:ys};const ks="2.7.4",Ts={"X-Client-Info":`realtime-js/${ks}`},xs="1.0.0",Rt=1e4,Ss=1e3;var xe;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(xe||(xe={}));var Z;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Z||(Z={}));var te;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(te||(te={}));var Ge;(function(n){n.websocket="websocket"})(Ge||(Ge={}));var he;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(he||(he={}));class Pt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Es{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+r));a=a+r;const l=s.decode(e.slice(a,a+i));a=a+i;const h=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:h}}}class Fe{constructor(e,t,s={},r=Rt){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ct;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ct||(ct={}));class Se{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Se.syncState(this.state,r,i,a),this.pendingDiffs.forEach(l=>{this.state=Se.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=Se.syncDiff(this.state,r,i,a),o())}),this.onJoin((r,i,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:a})}),this.onLeave((r,i,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(h,c)=>{a[h]||(l[h]=c)}),this.map(a,(h,c)=>{const u=i[h];if(u){const d=c.map(w=>w.presence_ref),f=u.map(w=>w.presence_ref),_=c.filter(w=>f.indexOf(w.presence_ref)<0),g=u.filter(w=>d.indexOf(w.presence_ref)<0);_.length>0&&(o[h]=_),g.length>0&&(l[h]=g)}else o[h]=c}),this.syncDiff(i,{joins:o,leaves:l},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(o,l)=>{var h;const c=(h=e[o])!==null&&h!==void 0?h:[];if(e[o]=this.cloneDeep(l),c.length>0){const u=e[o].map(f=>f.presence_ref),d=c.filter(f=>u.indexOf(f.presence_ref)<0);e[o].unshift(...d)}s(o,c,l)}),this.map(a,(o,l)=>{let h=e[o];if(!h)return;const c=l.map(u=>u.presence_ref);h=h.filter(u=>c.indexOf(u.presence_ref)<0),e[o]=h,r(o,h,l),h.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return"metas"in r?t[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var A;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(A||(A={}));const ht=(n,e,t={})=>{var s;const r=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=Os(a,n,e,r),i),{})},Os=(n,e,t,s)=>{const r=e.find(o=>o.name===n),i=r==null?void 0:r.type,a=t[n];return i&&!s.includes(i)?It(i,a):Ke(a)},It=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Rs(e,t)}switch(n){case A.bool:return Cs(e);case A.float4:case A.float8:case A.int2:case A.int4:case A.int8:case A.numeric:case A.oid:return js(e);case A.json:case A.jsonb:return As(e);case A.timestamp:return Ps(e);case A.abstime:case A.date:case A.daterange:case A.int4range:case A.int8range:case A.money:case A.reltime:case A.text:case A.time:case A.timestamptz:case A.timetz:case A.tsrange:case A.tstzrange:return Ke(e);default:return Ke(e)}},Ke=n=>n,Cs=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},js=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},As=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Rs=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>It(e,o))}return n},Ps=n=>typeof n=="string"?n.replace(" ","T"):n;var ut=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})},dt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(dt||(dt={}));var ft;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(ft||(ft={}));var gt;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(gt||(gt={}));class tt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Z.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Fe(this,te.join,this.params,this.timeout),this.rejoinTimer=new Pt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Z.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Z.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Z.errored,this.rejoinTimer.scheduleTimeout())}),this._on(te.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new Se(this)}subscribe(e,t=this.timeout){var s,r;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a}}=this.params;this._onError(h=>e&&e("CHANNEL_ERROR",h)),this._onClose(()=>e&&e("CLOSED"));const o={},l={broadcast:i,presence:a,postgres_changes:(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(h=>h.filter))!==null&&r!==void 0?r:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:h})=>{var c;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),h===void 0){e&&e("SUBSCRIBED");return}else{const u=this.bindings.postgres_changes,d=(c=u==null?void 0:u.length)!==null&&c!==void 0?c:0,f=[];for(let _=0;_<d;_++){const g=u[_],{filter:{event:w,schema:b,table:k,filter:P}}=g,$=h&&h[_];if($&&$.event===w&&$.schema===b&&$.table===k&&$.filter===P)f.push(Object.assign(Object.assign({},g),{id:$.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",h=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return ut(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return ut(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,s){return this._on(e,t,s)}send(e,t={}){return new Promise(s=>{var r,i,a;const o=this._push(e.type,e,t.timeout||this.timeout);o.rateLimited&&s("rate limited"),e.type==="broadcast"&&!(!((a=(i=(r=this.params)===null||r===void 0?void 0:r.config)===null||i===void 0?void 0:i.broadcast)===null||a===void 0)&&a.ack)&&s("ok"),o.receive("ok",()=>s("ok")),o.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Z.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(te.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const r=new Fe(this,te.leave,{},e);r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})})}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Fe(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:h,join:c}=te;if(s&&[o,l,h,c].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(f=>{var _,g,w;return((_=f.filter)===null||_===void 0?void 0:_.event)==="*"||((w=(g=f.filter)===null||g===void 0?void 0:g.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===a}).map(f=>f.callback(d,s)):(i=this.bindings[a])===null||i===void 0||i.filter(f=>{var _,g,w,b,k,P;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const $=f.id,q=(_=f.filter)===null||_===void 0?void 0:_.event;return $&&((g=t.ids)===null||g===void 0?void 0:g.includes($))&&(q==="*"||(q==null?void 0:q.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const $=(k=(b=f==null?void 0:f.filter)===null||b===void 0?void 0:b.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return $==="*"||$===((P=t==null?void 0:t.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof d=="object"&&"ids"in d){const _=d.data,{schema:g,table:w,commit_timestamp:b,type:k,errors:P}=_;d=Object.assign(Object.assign({},{schema:g,table:w,commit_timestamp:b,eventType:k,new:{},old:{},errors:P}),this._getPayloadRecords(_))}f.callback(d,s)})}_isClosed(){return this.state===Z.closed}_isJoined(){return this.state===Z.joined}_isJoining(){return this.state===Z.joining}_isLeaving(){return this.state===Z.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&tt.isEqual(r.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(te.close,{},e)}_onError(e){this._on(te.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Z.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ht(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ht(e.columns,e.old_record)),t}}var qe=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};const Is=()=>{};class Ls{constructor(e,t){var s,r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Ts,this.params={},this.timeout=Rt,this.transport=$s.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Is,this.conn=null,this.sendBuffer=[],this.serializer=new Es,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${Ge.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.eventsPerSecond;i&&(this.eventsPerSecondLimitMs=Math.floor(1e3/i));const a=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;a&&(this.accessToken=a),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(o,l)=>l(JSON.stringify(o)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Pt(()=>qe(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return qe(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return qe(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case xe.connecting:return he.Connecting;case xe.open:return he.Open;case xe.closing:return he.Closing;default:return he.Closed}}isConnected(){return this.connectionState()===he.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const s=new tt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e;let a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};if(this.log("push",`${t} ${s} (${i})`,r),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(s)){if(this._throttle(a)())return"rate limited"}else a();else this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(te.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:xs}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:r,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||r===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${r} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(r,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(te.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Ss,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class st extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ds extends st{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class pt extends st{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Us=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};const Lt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Le(()=>Promise.resolve().then(()=>De),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Ns=()=>Us(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Le(()=>Promise.resolve().then(()=>De),void 0,import.meta.url)).Response:Response});var me=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};const Be=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ms=(n,e)=>me(void 0,void 0,void 0,function*(){const t=yield Ns();n instanceof t?n.json().then(s=>{e(new Ds(Be(s),n.status||500))}).catch(s=>{e(new pt(Be(s),s))}):e(new pt(Be(n),n))}),Fs=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};function Ue(n,e,t,s,r,i){return me(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,Fs(e,s,r,i)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>Ms(l,o))})})}function We(n,e,t,s){return me(this,void 0,void 0,function*(){return Ue(n,"GET",e,t,s)})}function ae(n,e,t,s,r){return me(this,void 0,void 0,function*(){return Ue(n,"POST",e,s,r,t)})}function qs(n,e,t,s,r){return me(this,void 0,void 0,function*(){return Ue(n,"PUT",e,s,r,t)})}function Dt(n,e,t,s,r){return me(this,void 0,void 0,function*(){return Ue(n,"DELETE",e,s,r,t)})}var ee=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};const Bs={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},vt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class zs{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Lt(r)}uploadOrUpdate(e,t,s,r){return ee(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},vt),r),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl)):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const l=this._removeEmptyFolders(t),h=this._getFinalPath(l),c=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return c.ok?{data:{path:l},error:null}:{data:null,error:yield c.json()}}catch(i){if(B(i))return{data:null,error:i};throw i}})}upload(e,t,s){return ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return ee(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const h=Object.assign({upsert:vt.upsert},r),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",h.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",h.cacheControl)):(l=s,c["cache-control"]=`max-age=${h.cacheControl}`,c["content-type"]=h.contentType);const u=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:c});return u.ok?{data:{path:i},error:null}:{data:null,error:yield u.json()}}catch(l){if(B(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return ee(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const s=yield ae(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),r=new URL(this.url+s.url),i=r.searchParams.get("token");if(!i)throw new st("No token returned by API");return{data:{signedUrl:r.toString(),path:e,token:i},error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}update(e,t,s){return ee(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t){return ee(this,void 0,void 0,function*(){try{return{data:yield ae(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}copy(e,t){return ee(this,void 0,void 0,function*(){try{return{data:{path:(yield ae(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,s){return ee(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield ae(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return ee(this,void 0,void 0,function*(){try{const r=yield ae(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:r.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}download(e,t){return ee(this,void 0,void 0,function*(){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield We(this.fetch,`${this.url}/${r}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(B(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&r.push(l);let h=r.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${h}`)}}}remove(e){return ee(this,void 0,void 0,function*(){try{return{data:yield Dt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}list(e,t,s){return ee(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Bs),t),{prefix:e||""});return{data:yield ae(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Hs="2.5.4",Js={"X-Client-Info":`storage-js/${Hs}`};var ue=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};class Vs{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Js),t),this.fetch=Lt(s)}listBuckets(){return ue(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ue(this,void 0,void 0,function*(){try{return{data:yield ae(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ue(this,void 0,void 0,function*(){try{return{data:yield qs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield ae(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield Dt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}}class Gs extends Vs{constructor(e,t={},s){super(e,t,s)}from(e){return new zs(this.url,this.headers,e,this.fetch)}}const Ks="2.36.0";let ke="";typeof Deno<"u"?ke="deno":typeof document<"u"?ke="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ke="react-native":ke="node";const Ws={"X-Client-Info":`supabase-js-${ke}/${Ks}`};var Ys=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};const Qs=n=>{let e;return n?e=n:typeof fetch>"u"?e=Ze:e=fetch,(...t)=>e(...t)},Xs=()=>typeof Headers>"u"?Xe.Headers:Headers,Zs=(n,e,t)=>{const s=Qs(t),r=Xs();return(i,a)=>Ys(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:n;let h=new r(a==null?void 0:a.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${l}`),s(i,Object.assign(Object.assign({},a),{headers:h}))})};function er(n){return n.replace(/\/$/,"")}function tr(n,e){const{db:t,auth:s,realtime:r,global:i}=n,{db:a,auth:o,realtime:l,global:h}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},l),r),global:Object.assign(Object.assign({},h),i)}}function sr(n){return Math.round(Date.now()/1e3)+n}function rr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const ie=()=>typeof document<"u",le={tested:!1,writable:!1},Ee=()=>{if(!ie())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(le.tested)return le.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),le.tested=!0,le.writable=!0}catch{le.tested=!0,le.writable=!1}return le.writable};function ze(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((s,r)=>{e[r]=s}),e}const Ut=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Le(()=>Promise.resolve().then(()=>De),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},ir=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",de=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Re=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},He=async(n,e)=>{await n.removeItem(e)};function nr(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,r,i,a,o,l,h,c=0;for(n=n.replace("-","+").replace("_","/");c<n.length;)a=e.indexOf(n.charAt(c++)),o=e.indexOf(n.charAt(c++)),l=e.indexOf(n.charAt(c++)),h=e.indexOf(n.charAt(c++)),s=a<<2|o>>4,r=(o&15)<<4|l>>2,i=(l&3)<<6|h,t=t+String.fromCharCode(s),l!=64&&r!=0&&(t=t+String.fromCharCode(r)),h!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Ne{constructor(){this.promise=new Ne.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ne.promiseConstructor=Promise;function mt(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(nr(s))}async function ar(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function or(n,e){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){r(a);return}}})()})}function lr(n){return("0"+n.toString(16)).substr(-2)}function be(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,lr).join("")}async function cr(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}function hr(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ye(n){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=await cr(n);return hr(e)}class rt extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function O(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class ur extends rt{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function dr(n){return O(n)&&n.name==="AuthApiError"}class Nt extends rt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class _e extends rt{constructor(e,t,s){super(e),this.name=t,this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class fe extends _e{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Je extends _e{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Pe extends _e{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Ie extends _e{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class _t extends _e{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ye extends _e{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function wt(n){return O(n)&&n.name==="AuthRetryableFetchError"}var fr=globalThis&&globalThis.__rest||function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const Te=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),gr=[502,503,504];async function bt(n){if(!ir(n))throw new Ye(Te(n),0);if(gr.includes(n.status))throw new Ye(Te(n),n.status);let e;try{e=await n.json()}catch(t){throw new Nt(Te(t),t)}throw new ur(Te(e),n.status||500)}const pr=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};async function C(n,e,t,s){var r;const i=Object.assign({},s==null?void 0:s.headers);s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(r=s==null?void 0:s.query)!==null&&r!==void 0?r:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await vr(n,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function vr(n,e,t,s,r,i){const a=pr(e,s,r,i);let o;try{o=await n(t,a)}catch(l){throw console.error(l),new Ye(Te(l),0)}if(o.ok||await bt(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(l){await bt(l)}}function ne(n){var e;let t=null;br(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=sr(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function oe(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function mr(n){return{data:n,error:null}}function _r(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i}=n,a=fr(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function wr(n){return n}function br(n){return n.access_token&&n.refresh_token&&n.expires_in}var yr=globalThis&&globalThis.__rest||function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class $r{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Ut(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await C(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await C(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:oe})}catch(s){if(O(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=yr(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=s==null?void 0:s.newEmail,delete r.newEmail),await C(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:_r,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(O(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await C(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oe})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,a,o,l;try{const h={nextPage:null,lastPage:0,total:0},c=await C(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:wr});if(c.error)throw c.error;const u=await c.json(),d=(a=c.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(l=(o=c.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(_=>{const g=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(_.split(";")[1].split("=")[1]);h[`${w}Page`]=g}),h.total=parseInt(d)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(O(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){try{return await C(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oe})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await C(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:oe})}catch(s){if(O(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await C(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:oe})}catch(s){if(O(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await C(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:s}}catch(t){if(O(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await C(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}}}const Mt="2.54.0",kr="http://localhost:9999",Tr="supabase.auth.token",xr={"X-Client-Info":`gotrue-js/${Mt}`},yt=10,Sr={getItem:n=>Ee()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ee()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ee()&&globalThis.localStorage.removeItem(n)}};function $t(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Er(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}globalThis&&Ee()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug");class Or extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}Er();const Cr={url:kr,storageKey:Tr,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:xr,flowType:"implicit",debug:!1},$e=30*1e3,kt=3;async function jr(n,e,t){return await t()}class je{constructor(e){var t;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=je.nextInstanceID,je.nextInstanceID+=1,this.instanceID>0&&ie()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Cr),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new $r({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ut(s.fetch),this.lock=s.lock||jr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Ee()?this.storage=Sr:(this.memoryStorage={},this.storage=$t(this.memoryStorage)):(this.memoryStorage={},this.storage=$t(this.memoryStorage)),ie()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Mt}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=ie()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),await this._removeSession(),{error:s};const{session:r,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",r,"redirect type",i),await this._saveSession(r),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return O(e)?{error:e}:{error:new Nt("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,s,r;try{await this._removeSession();let i;if("email"in e){const{email:c,password:u,options:d}=e;let f=null,_=null;if(this.flowType==="pkce"){const g=be();await de(this.storage,`${this.storageKey}-code-verifier`,g),f=await ye(g),_=g===f?"plain":"s256"}i=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:c,password:u,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:_},xform:ne})}else if("phone"in e){const{phone:c,password:u,options:d}=e;i=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:u,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(r=d==null?void 0:d.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:ne})}else throw new Pe("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(i){if(O(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await C(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ne})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await C(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ne})}else throw new Pe("You must provide either an email or phone number and a password");const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Je}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:{user:s.user,session:s.session},error:r})}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Re(this.storage,`${this.storageKey}-code-verifier`),{data:s,error:r}=await C(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:ne});return await He(this.storage,`${this.storageKey}-code-verifier`),r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Je}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:s,error:r})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:s,token:r,access_token:i,nonce:a}=e,o=await C(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ne}),{data:l,error:h}=o;return h?{data:{user:null,session:null},error:h}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Je}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:h})}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,a;try{if(await this._removeSession(),"email"in e){const{email:o,options:l}=e;let h=null,c=null;if(this.flowType==="pkce"){const d=be();await de(this.storage,`${this.storageKey}-code-verifier`,d),h=await ye(d),c=d===h?"plain":"s256"}const{error:u}=await C(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:h,code_challenge_method:c},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:o,options:l}=e,{data:h,error:c}=await C(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:c}}throw new Pe("You must provide either an email or phone number.")}catch(o){if(O(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await C(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:ne});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,h=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(r){if(O(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{return await this._removeSession(),await C(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:mr})}catch(i){if(O(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new fe;const{error:r}=await C(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(O(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:a}=await C(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:r,options:i}=e,{data:a,error:o}=await C(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Pe("You must provide either an email or phone number and a type")}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Re(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s)return{data:{session:e},error:null};const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await C(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oe}):await this._useSession(async t=>{var s,r;const{data:i,error:a}=t;if(a)throw a;return await C(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:oe})})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new fe;const a=r.session;let o=null,l=null;if(this.flowType==="pkce"&&e.email!=null){const u=be();await de(this.storage,`${this.storageKey}-code-verifier`,u),o=await ye(u),l=u===o?"plain":"s256"}const{data:h,error:c}=await C(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:oe});if(c)throw c;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(O(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return mt(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new fe;const t=Date.now()/1e3;let s=t,r=!0,i=null;const a=mt(e.access_token);if(a.exp&&(s=a.exp,r=s<=t),r){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(O(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new fe;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!ie())throw new Ie("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Ie("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new _t("Not a valid PKCE flow url.");const t=ze(window.location.href);if(e){if(!t.code)throw new _t("No code detected.");const{data:k,error:P}=await this._exchangeCodeForSession(t.code);if(P)throw P;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:k.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ie(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:h}=t;if(!i||!o||!a||!h)throw new Ie("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(o);let d=c+u;l&&(d=parseInt(l));const f=d-c;f*1e3<=$e&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const _=d-u;c-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,d,c):c-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",_,d,c);const{data:g,error:w}=await this._getUser(i);if(w)throw w;const b={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:u,expires_at:d,refresh_token:a,token_type:h,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:t.type},error:null}}catch(t){if(O(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=ze(window.location.href);return!!(ie()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=ze(window.location.href),t=await Re(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const a=(s=r.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(dr(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(await this._removeSession(),await He(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=rr(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;if(this.flowType==="pkce"){const i=be();await de(this.storage,`${this.storageKey}-code-verifier`,i),s=await ye(i),r=i===s?"plain":"s256"}try{return await C(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(O(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await or(async r=>(await ar(r*200),this._debug(t,"refreshing attempt",r),await C(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ne})),(r,i,a)=>a&&a.error&&wt(a.error)&&Date.now()+(r+1)*200-s<$e)}catch(s){if(this._debug(t,"error",s),O(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),ie()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Re(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const r=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<r+yt;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${yt}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),wt(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new fe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ne;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new fe;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(r,"error",i),O(i)){const a={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),de(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await He(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ie()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),$e);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/$e);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${$e}ms, refresh threshold is ${kt} ticks`),r<=kt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Or)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ie()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){const s=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&s.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&s.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const r=be();await de(this.storage,`${this.storageKey}-code-verifier`,r);const i=await ye(r),a=r===i?"plain":"s256";this._debug("PKCE","code verifier",`${r.substring(0,5)}...`,"code challenge",i,"method",a);const o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(t!=null&&t.queryParams){const r=new URLSearchParams(t.queryParams);s.push(r.toString())}return`${this.url}/authorize?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await C(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(O(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:a}=t;if(a)return{data:null,error:a};const{data:o,error:l}=await C(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(O(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await C(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(O(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await C(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(O(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],r=s.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:s,totp:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(r.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((s=(t=r.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const c=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:c},error:null}}))}}je.nextInstanceID=0;class Ar extends je{constructor(e){super(e)}}var Rr=globalThis&&globalThis.__awaiter||function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{h(s.next(c))}catch(u){a(u)}}function l(c){try{h(s.throw(c))}catch(u){a(u)}}function h(c){c.done?i(c.value):r(c.value).then(o,l)}h((s=s.apply(n,e||[])).next())})};const Pr={headers:Ws},Ir={schema:"public"},Lr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Dr={};class Ur{constructor(e,t,s){var r,i,a,o,l,h,c,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=er(e);this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const f=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,_={db:Ir,realtime:Dr,auth:Object.assign(Object.assign({},Lr),{storageKey:f}),global:Pr},g=tr(s??{},_);this.storageKey=(i=(r=g.auth)===null||r===void 0?void 0:r.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=(a=g.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((l=g.auth)!==null&&l!==void 0?l:{},this.headers,(h=g.global)===null||h===void 0?void 0:h.fetch),this.fetch=Zs(t,this._getAccessToken.bind(this),(c=g.global)===null||c===void 0?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},g.realtime)),this.rest=new et(`${d}/rest/v1`,{headers:this.headers,schema:(u=g.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Kt(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Gs(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Rr(this,void 0,void 0,function*(){const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:a,debug:o},l,h){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ar({url:this.authUrl,headers:Object.assign(Object.assign({},c),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:a,debug:o,fetch:h})}_initRealtimeClient(e){return new Ls(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Nr=(n,e,t)=>new Ur(n,e,t);function Mr(n){let e,t;return{c(){e=H("svg"),t=H("path"),this.h()},l(s){e=J(s,"svg",{xmlns:!0,class:!0,width:!0,height:!0,viewBox:!0,id:!0});var r=y(e);t=J(r,"path",{d:!0}),y(t).forEach(m),r.forEach(m),this.h()},h(){p(t,"d","M6.25753788,13.2424621 C5.84748737,12.8324116 5.84748737,12.1675884 6.25753788,11.7575379 C6.66758839,11.3474874 7.33241161,11.3474874 7.74246212,11.7575379 L12,16.0150758 L16.2575379,11.7575379 C16.6675884,11.3474874 17.3324116,11.3474874 17.7424621,11.7575379 C18.1525126,12.1675884 18.1525126,12.8324116 17.7424621,13.2424621 L12.7424621,18.2424621 C12.3324116,18.6525126 11.6675884,18.6525126 11.2575379,18.2424621 L6.25753788,13.2424621 Z M6.25753788,7.24246212 C5.84748737,6.83241161 5.84748737,6.16758839 6.25753788,5.75753788 C6.66758839,5.34748737 7.33241161,5.34748737 7.74246212,5.75753788 L12,10.0150758 L16.2575379,5.75753788 C16.6675884,5.34748737 17.3324116,5.34748737 17.7424621,5.75753788 C18.1525126,6.16758839 18.1525126,6.83241161 17.7424621,7.24246212 L12.7424621,12.2424621 C12.3324116,12.6525126 11.6675884,12.6525126 11.2575379,12.2424621 L6.25753788,7.24246212 Z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"class","light mt-5"),p(e,"width","24"),p(e,"height","24"),p(e,"viewBox","0 0 24 24"),p(e,"id","chevron-force-down")},m(s,r){M(s,e,r),v(e,t)},p:S,i:S,o:S,d(s){s&&m(e)}}}class Fr extends G{constructor(e){super(),K(this,e,null,Mr,V,{})}}function qr(n){let e,t;return{c(){e=H("svg"),t=H("path"),this.h()},l(s){e=J(s,"svg",{xmlns:!0,class:!0,x:!0,y:!0,viewBox:!0});var r=y(e);t=J(r,"path",{d:!0}),y(t).forEach(m),r.forEach(m),this.h()},h(){p(t,"d","M 16 3 C 8.8324839 3 3 8.8324839 3 16 L 3 34 C 3 41.167516 8.8324839 47 16 47 L 34 47 C 41.167516 47 47 41.167516 47 34 L 47 16 C 47 8.8324839 41.167516 3 34 3 L 16 3 z M 16 5 L 34 5 C 40.086484 5 45 9.9135161 45 16 L 45 34 C 45 40.086484 40.086484 45 34 45 L 16 45 C 9.9135161 45 5 40.086484 5 34 L 5 16 C 5 9.9135161 9.9135161 5 16 5 z M 37 11 A 2 2 0 0 0 35 13 A 2 2 0 0 0 37 15 A 2 2 0 0 0 39 13 A 2 2 0 0 0 37 11 z M 25 14 C 18.936712 14 14 18.936712 14 25 C 14 31.063288 18.936712 36 25 36 C 31.063288 36 36 31.063288 36 25 C 36 18.936712 31.063288 14 25 14 z M 25 16 C 29.982407 16 34 20.017593 34 25 C 34 29.982407 29.982407 34 25 34 C 20.017593 34 16 29.982407 16 25 C 16 20.017593 20.017593 16 25 16 z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"class","light"),p(e,"x","0px"),p(e,"y","0px"),p(e,"viewBox","0 0 50 50")},m(s,r){M(s,e,r),v(e,t)},p:S,i:S,o:S,d(s){s&&m(e)}}}class Br extends G{constructor(e){super(),K(this,e,null,qr,V,{})}}function zr(n){let e,t;return{c(){e=H("svg"),t=H("path"),this.h()},l(s){e=J(s,"svg",{xmlns:!0,class:!0,x:!0,y:!0,viewBox:!0});var r=y(e);t=J(r,"path",{d:!0}),y(t).forEach(m),r.forEach(m),this.h()},h(){p(t,"d","M15 7H9C8.447 7 8 7.447 8 8v33c0 .553.447 1 1 1h6c.553 0 1-.447 1-1V8C16 7.447 15.553 7 15 7zM31 7A13 13 0 1031 33 13 13 0 1031 7z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"class","light"),p(e,"x","0px"),p(e,"y","0px"),p(e,"viewBox","0 0 50 50")},m(s,r){M(s,e,r),v(e,t)},p:S,i:S,o:S,d(s){s&&m(e)}}}class Hr extends G{constructor(e){super(),K(this,e,null,zr,V,{})}}function Jr(n){let e,t;return{c(){e=H("svg"),t=H("path"),this.h()},l(s){e=J(s,"svg",{xmlns:!0,class:!0,x:!0,y:!0,viewBox:!0});var r=y(e);t=J(r,"path",{d:!0}),y(t).forEach(m),r.forEach(m),this.h()},h(){p(t,"d","M25.009,1.982C12.322,1.982,2,12.304,2,24.991S12.322,48,25.009,48s23.009-10.321,23.009-23.009S37.696,1.982,25.009,1.982z M34.748,35.333c-0.289,0.434-0.765,0.668-1.25,0.668c-0.286,0-0.575-0.081-0.831-0.252C30.194,34.1,26,33,22.5,33.001 c-3.714,0.002-6.498,0.914-6.526,0.923c-0.784,0.266-1.635-0.162-1.897-0.948s0.163-1.636,0.949-1.897 c0.132-0.044,3.279-1.075,7.474-1.077C26,30,30.868,30.944,34.332,33.253C35.022,33.713,35.208,34.644,34.748,35.333z M37.74,29.193 c-0.325,0.522-0.886,0.809-1.459,0.809c-0.31,0-0.624-0.083-0.906-0.26c-4.484-2.794-9.092-3.385-13.062-3.35 c-4.482,0.04-8.066,0.895-8.127,0.913c-0.907,0.258-1.861-0.272-2.12-1.183c-0.259-0.913,0.272-1.862,1.184-2.12 c0.277-0.079,3.854-0.959,8.751-1c4.465-0.037,10.029,0.61,15.191,3.826C37.995,27.328,38.242,28.388,37.74,29.193z M40.725,22.013 C40.352,22.647,39.684,23,38.998,23c-0.344,0-0.692-0.089-1.011-0.275c-5.226-3.068-11.58-3.719-15.99-3.725 c-0.021,0-0.042,0-0.063,0c-5.333,0-9.44,0.938-9.481,0.948c-1.078,0.247-2.151-0.419-2.401-1.495 c-0.25-1.075,0.417-2.149,1.492-2.4C11.729,16.01,16.117,15,21.934,15c0.023,0,0.046,0,0.069,0 c4.905,0.007,12.011,0.753,18.01,4.275C40.965,19.835,41.284,21.061,40.725,22.013z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"class","light"),p(e,"x","0px"),p(e,"y","0px"),p(e,"viewBox","0 0 50 50")},m(s,r){M(s,e,r),v(e,t)},p:S,i:S,o:S,d(s){s&&m(e)}}}class Vr extends G{constructor(e){super(),K(this,e,null,Jr,V,{})}}function Gr(n){let e,t;return{c(){e=H("svg"),t=H("path"),this.h()},l(s){e=J(s,"svg",{xmlns:!0,class:!0,x:!0,y:!0,viewBox:!0});var r=y(e);t=J(r,"path",{d:!0}),y(t).forEach(m),r.forEach(m),this.h()},h(){p(t,"d","M 44.898438 14.5 C 44.5 12.300781 42.601563 10.699219 40.398438 10.199219 C 37.101563 9.5 31 9 24.398438 9 C 17.800781 9 11.601563 9.5 8.300781 10.199219 C 6.101563 10.699219 4.199219 12.199219 3.800781 14.5 C 3.398438 17 3 20.5 3 25 C 3 29.5 3.398438 33 3.898438 35.5 C 4.300781 37.699219 6.199219 39.300781 8.398438 39.800781 C 11.898438 40.5 17.898438 41 24.5 41 C 31.101563 41 37.101563 40.5 40.601563 39.800781 C 42.800781 39.300781 44.699219 37.800781 45.101563 35.5 C 45.5 33 46 29.398438 46.101563 25 C 45.898438 20.5 45.398438 17 44.898438 14.5 Z M 19 32 L 19 18 L 31.199219 25 Z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"class","light"),p(e,"x","0px"),p(e,"y","0px"),p(e,"viewBox","0 0 50 50")},m(s,r){M(s,e,r),v(e,t)},p:S,i:S,o:S,d(s){s&&m(e)}}}class Kr extends G{constructor(e){super(),K(this,e,null,Gr,V,{})}}function Wr(n){let e,t,s='<h3 class="light-text z-10">Menajerie</h3>',r,i,a,o,l,h,c,u,d,f,_,g,w,b;return o=new Vr({}),c=new Kr({}),f=new Hr({}),w=new Br({}),{c(){e=T("div"),t=T("div"),t.innerHTML=s,r=L(),i=T("div"),a=T("button"),W(o.$$.fragment),l=L(),h=T("button"),W(c.$$.fragment),u=L(),d=T("button"),W(f.$$.fragment),_=L(),g=T("button"),W(w.$$.fragment),this.h()},l(k){e=x(k,"DIV",{class:!0});var P=y(e);t=x(P,"DIV",{class:!0,"data-svelte-h":!0}),se(t)!=="svelte-1h7i5lk"&&(t.innerHTML=s),r=D(P),i=x(P,"DIV",{class:!0});var $=y(i);a=x($,"BUTTON",{class:!0});var q=y(a);Y(o.$$.fragment,q),q.forEach(m),l=D($),h=x($,"BUTTON",{class:!0});var U=y(h);Y(c.$$.fragment,U),U.forEach(m),u=D($),d=x($,"BUTTON",{class:!0});var j=y(d);Y(f.$$.fragment,j),j.forEach(m),_=D($),g=x($,"BUTTON",{class:!0});var I=y(g);Y(w.$$.fragment,I),I.forEach(m),$.forEach(m),P.forEach(m),this.h()},h(){p(t,"class","flex-1"),p(a,"class","btn btn-square btn-ghost"),p(h,"class","btn btn-square btn-ghost"),p(d,"class","btn btn-square btn-ghost"),p(g,"class","btn btn-square btn-ghost"),p(i,"class","flex-none"),p(e,"class","navbar mt-8 z-10")},m(k,P){M(k,e,P),v(e,t),v(e,r),v(e,i),v(i,a),Q(o,a,null),v(i,l),v(i,h),Q(c,h,null),v(i,u),v(i,d),Q(f,d,null),v(i,_),v(i,g),Q(w,g,null),b=!0},p:S,i(k){b||(N(o.$$.fragment,k),N(c.$$.fragment,k),N(f.$$.fragment,k),N(w.$$.fragment,k),b=!0)},o(k){F(o.$$.fragment,k),F(c.$$.fragment,k),F(f.$$.fragment,k),F(w.$$.fragment,k),b=!1},d(k){k&&m(e),X(o),X(c),X(f),X(w)}}}class Yr extends G{constructor(e){super(),K(this,e,null,Wr,V,{})}}function Qr(n){let e,t,s,r,i,a,o,l,h,c,u,d,f,_,g="Debut EP",w,b,k="Selective Deafness",P,$,q="Out Now",U,j,I;return u=new Yr({}),j=new Fr({}),{c(){e=T("div"),t=T("div"),s=L(),r=T("div"),i=L(),a=T("div"),o=L(),l=T("div"),h=L(),c=T("div"),W(u.$$.fragment),d=L(),f=T("div"),_=T("h2"),_.textContent=g,w=L(),b=T("h1"),b.textContent=k,P=L(),$=T("h2"),$.textContent=q,U=L(),W(j.$$.fragment),this.h()},l(E){e=x(E,"DIV",{class:!0});var R=y(e);t=x(R,"DIV",{class:!0}),y(t).forEach(m),s=D(R),r=x(R,"DIV",{class:!0}),y(r).forEach(m),i=D(R),a=x(R,"DIV",{class:!0}),y(a).forEach(m),o=D(R),l=x(R,"DIV",{class:!0}),y(l).forEach(m),h=D(R),c=x(R,"DIV",{class:!0});var re=y(c);Y(u.$$.fragment,re),d=D(re),f=x(re,"DIV",{class:!0});var z=y(f);_=x(z,"H2",{class:!0,"data-svelte-h":!0}),se(_)!=="svelte-k7x6d4"&&(_.textContent=g),w=D(z),b=x(z,"H1",{class:!0,"data-svelte-h":!0}),se(b)!=="svelte-gco7ry"&&(b.textContent=k),P=D(z),$=x(z,"H2",{class:!0,"data-svelte-h":!0}),se($)!=="svelte-1pnmtyx"&&($.textContent=q),U=D(z),Y(j.$$.fragment,z),z.forEach(m),re.forEach(m),R.forEach(m),this.h()},h(){p(t,"class","curved-bottom-border-hero svelte-1d0geq"),p(r,"class","curved-bottom-border-hero outline-01 svelte-1d0geq"),p(a,"class","curved-bottom-border-hero outline-02 svelte-1d0geq"),p(l,"class","curved-bottom-border-hero outline-03 svelte-1d0geq"),p(_,"class","light-text"),p(b,"class","light-text"),p($,"class","light-text"),p(f,"class","z-10 mb-2 flex flex-col gap-2.5 items-center"),p(c,"class","w-9/12 mb-24 h-full flex flex-col justify-between items-center"),p(e,"class","h-screen w-screen flex flex-col items-center")},m(E,R){M(E,e,R),v(e,t),v(e,s),v(e,r),v(e,i),v(e,a),v(e,o),v(e,l),v(e,h),v(e,c),Q(u,c,null),v(c,d),v(c,f),v(f,_),v(f,w),v(f,b),v(f,P),v(f,$),v(f,U),Q(j,f,null),I=!0},p:S,i(E){I||(N(u.$$.fragment,E),N(j.$$.fragment,E),I=!0)},o(E){F(u.$$.fragment,E),F(j.$$.fragment,E),I=!1},d(E){E&&m(e),X(u),X(j)}}}class Xr extends G{constructor(e){super(),K(this,e,null,Qr,V,{})}}function Zr(n){let e,t=`<figure class="w-1/3"><div class="album-art svelte-na9cmd"></div></figure> <div class="w-2/3 flex flex-col gap-8 justify-center p-16"><h1>Selective Deafness</h1> <h2>Debut EP Out Now</h2> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse
      varius enim in eros elementum tristique. Duis cursus, mi quis viverra
      ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat.</p> <button class="btn btn-primary w-1/4 light-text">Listen Now</button></div>`;return{c(){e=T("div"),e.innerHTML=t,this.h()},l(s){e=x(s,"DIV",{class:!0,"data-svelte-h":!0}),se(e)!=="svelte-1ydx3bq"&&(e.innerHTML=t),this.h()},h(){p(e,"class","-mt-16 card lg:card-side bg-base-100 shadow-xl")},m(s,r){M(s,e,r)},p:S,i:S,o:S,d(s){s&&m(e)}}}class ei extends G{constructor(e){super(),K(this,e,null,Zr,V,{})}}function ti(n){let e,t='<h3>&#39;Stuck&#39; Music Video</h3> <div class="px-24 w-full"><iframe class="w-full aspect-video shadow-xl" src="https://www.youtube.com/embed/TvqwXvo0aHE?si=-zo4QMh61BSMklOO" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></div>';return{c(){e=T("div"),e.innerHTML=t,this.h()},l(s){e=x(s,"DIV",{class:!0,"data-svelte-h":!0}),se(e)!=="svelte-87qqo5"&&(e.innerHTML=t),this.h()},h(){p(e,"class","flex flex-col gap-20 w-full items-center")},m(s,r){M(s,e,r)},p:S,i:S,o:S,d(s){s&&m(e)}}}class si extends G{constructor(e){super(),K(this,e,null,ti,V,{})}}function ri(n){let e,t=`<div class="w-2/5"><h3>Neo-soul making, no shit taking, gonna get your booty shaking Menajerie
      are a 6-piece female led collective based in Meanjin/Brisbane.</h3></div> <div class="w-3/5 flex flex-col gap-4"><p>The group is fronted by songstress &amp; ivory-tinkler Gracie Mack, powerhouse
      vocalist Rosa Mack (Rosa Mack, KAYSO GRANDE) and fiery chanteuse Mel
      Galletly (Willis &amp; the Lovely Ones).</p> <p>Menajerie pens joyous, heartbreaking and honest originals with a strong
      focus on tight vocal harmony and cosmic funk.</p> <p>With Andrew Fincher (Kerbside Collection, HRBRT, CityPiss) playing guitar,
      Lee Brackenborough (Elktung, HRBRT, Big Dead) on bass and Beau Jorgensen
      (Mover, Stormchasers) on drums providing a powerful rhythm section,
      Menajerie leave their audience worshipping at a pussy shaped altar of
      Funk.</p></div>`;return{c(){e=T("div"),e.innerHTML=t,this.h()},l(s){e=x(s,"DIV",{class:!0,"data-svelte-h":!0}),se(e)!=="svelte-9mzv9t"&&(e.innerHTML=t),this.h()},h(){p(e,"class","flex items-center px-12 gap-12 w-full")},m(s,r){M(s,e,r)},p:S,i:S,o:S,d(s){s&&m(e)}}}class ii extends G{constructor(e){super(),K(this,e,null,ri,V,{})}}function ni(n){let e,t,s;return{c(){e=H("svg"),t=H("g"),s=H("path"),this.h()},l(r){e=J(r,"svg",{xmlns:!0,class:!0,viewBox:!0,id:!0});var i=y(e);t=J(i,"g",{"data-name":!0});var a=y(t);s=J(a,"path",{d:!0}),y(s).forEach(m),a.forEach(m),i.forEach(m),this.h()},h(){p(s,"d","M96 48c0 34.912-40.615 75.928-42.342 77.657a8.002 8.002 0 0 1-11.314 0C40.615 123.927 0 82.912 0 48a48 48 0 0 1 96 0zM48 72a24 24 0 1 0-24-24 23.999 23.999 0 0 0 24 24z"),p(t,"data-name","Layer 2"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"class","h-8"),p(e,"viewBox","0 0 96 128"),p(e,"id","location")},m(r,i){M(r,e,i),v(e,t),v(t,s)},p:S,i:S,o:S,d(r){r&&m(e)}}}class ai extends G{constructor(e){super(),K(this,e,null,ni,V,{})}}function oi(n){let e,t;return{c(){e=H("svg"),t=H("path"),this.h()},l(s){e=J(s,"svg",{class:!0,viewBox:!0});var r=y(e);t=J(r,"path",{d:!0}),y(t).forEach(m),r.forEach(m),this.h()},h(){p(t,"d","M10.25,2.375c-4.212,0-7.625,3.413-7.625,7.625s3.413,7.625,7.625,7.625s7.625-3.413,7.625-7.625S14.462,2.375,10.25,2.375M10.651,16.811v-0.403c0-0.221-0.181-0.401-0.401-0.401s-0.401,0.181-0.401,0.401v0.403c-3.443-0.201-6.208-2.966-6.409-6.409h0.404c0.22,0,0.401-0.181,0.401-0.401S4.063,9.599,3.843,9.599H3.439C3.64,6.155,6.405,3.391,9.849,3.19v0.403c0,0.22,0.181,0.401,0.401,0.401s0.401-0.181,0.401-0.401V3.19c3.443,0.201,6.208,2.965,6.409,6.409h-0.404c-0.22,0-0.4,0.181-0.4,0.401s0.181,0.401,0.4,0.401h0.404C16.859,13.845,14.095,16.609,10.651,16.811 M12.662,12.412c-0.156,0.156-0.409,0.159-0.568,0l-2.127-2.129C9.986,10.302,9.849,10.192,9.849,10V5.184c0-0.221,0.181-0.401,0.401-0.401s0.401,0.181,0.401,0.401v4.651l2.011,2.008C12.818,12.001,12.818,12.256,12.662,12.412"),p(e,"class","h-8 w-8"),p(e,"viewBox","0 0 20 20")},m(s,r){M(s,e,r),v(e,t)},p:S,i:S,o:S,d(s){s&&m(e)}}}class li extends G{constructor(e){super(),K(this,e,null,oi,V,{})}}function Tt(n,e,t){const s=n.slice();return s[1]=e[t],s}function xt(n){let e,t=n[1].blurb+"",s;return{c(){e=T("p"),s=pe(t),this.h()},l(r){e=x(r,"P",{class:!0});var i=y(e);s=ve(i,t),i.forEach(m),this.h()},h(){p(e,"class","py-8")},m(r,i){M(r,e,i),v(e,s)},p(r,i){i&1&&t!==(t=r[1].blurb+"")&&Oe(s,t)},d(r){r&&m(e)}}}function St(n){let e,t,s=n[1].time+"",r,i;return t=new li({}),{c(){e=T("div"),W(t.$$.fragment),r=pe(s),this.h()},l(a){e=x(a,"DIV",{class:!0});var o=y(e);Y(t.$$.fragment,o),r=ve(o,s),o.forEach(m),this.h()},h(){p(e,"class","flex gap-4 w-32")},m(a,o){M(a,e,o),Q(t,e,null),v(e,r),i=!0},p(a,o){(!i||o&1)&&s!==(s=a[1].time+"")&&Oe(r,s)},i(a){i||(N(t.$$.fragment,a),i=!0)},o(a){F(t.$$.fragment,a),i=!1},d(a){a&&m(e),X(t)}}}function Et(n){let e,t=n[1].venue_address+"",s;return{c(){e=pe(", "),s=pe(t)},l(r){e=ve(r,", "),s=ve(r,t)},m(r,i){M(r,e,i),M(r,s,i)},p(r,i){i&1&&t!==(t=r[1].venue_address+"")&&Oe(s,t)},d(r){r&&(m(e),m(s))}}}function Ot(n){let e,t,s,r,i=n[1].name+"",a,o,l,h,c,u,d,f,_,g=n[1].venue_name+"",w,b,k,P='<button class="flex-1 btn btn-primary shadow-lg normal-case text-lg font-medium">Buy Tickets</button> <button class="flex-1 btn bg-secondary w-full outline outline-1 shadow-lg normal-case text-lg font-medium">More Info</button>',$,q,U=n[1].blurb&&xt(n),j=n[1].time&&St(n);d=new ai({});let I=n[1].venue_address&&Et(n);return{c(){e=T("div"),t=T("div"),s=T("div"),r=T("h5"),a=pe(i),o=L(),U&&U.c(),l=L(),h=T("div"),j&&j.c(),c=L(),u=T("div"),W(d.$$.fragment),f=L(),_=T("span"),w=pe(g),I&&I.c(),b=L(),k=T("div"),k.innerHTML=P,$=L(),this.h()},l(E){e=x(E,"DIV",{class:!0});var R=y(e);t=x(R,"DIV",{class:!0});var re=y(t);s=x(re,"DIV",{class:!0});var z=y(s);r=x(z,"H5",{});var it=y(r);a=ve(it,i),it.forEach(m),o=D(z),U&&U.l(z),l=D(z),h=x(z,"DIV",{class:!0});var Ae=y(h);j&&j.l(Ae),c=D(Ae),u=x(Ae,"DIV",{class:!0});var we=y(u);Y(d.$$.fragment,we),f=D(we),_=x(we,"SPAN",{class:!0});var nt=y(_);w=ve(nt,g),nt.forEach(m),I&&I.l(we),we.forEach(m),Ae.forEach(m),z.forEach(m),b=D(re),k=x(re,"DIV",{class:!0,"data-svelte-h":!0}),se(k)!=="svelte-185670r"&&(k.innerHTML=P),re.forEach(m),$=D(R),R.forEach(m),this.h()},h(){p(_,"class","-mr-4 font-bold"),p(u,"class","flex items-center gap-4"),p(h,"class","flex items-center gap-8"),p(s,"class","flex flex-col justify-between"),p(k,"class","flex flex-col gap-4"),p(t,"class","flex p-8 justify-between items-center"),p(e,"class","card w-full bg-secondary outline outline-1.5 shadow-xl")},m(E,R){M(E,e,R),v(e,t),v(t,s),v(s,r),v(r,a),v(s,o),U&&U.m(s,null),v(s,l),v(s,h),j&&j.m(h,null),v(h,c),v(h,u),Q(d,u,null),v(u,f),v(u,_),v(_,w),I&&I.m(u,null),v(t,b),v(t,k),v(e,$),q=!0},p(E,R){(!q||R&1)&&i!==(i=E[1].name+"")&&Oe(a,i),E[1].blurb?U?U.p(E,R):(U=xt(E),U.c(),U.m(s,l)):U&&(U.d(1),U=null),E[1].time?j?(j.p(E,R),R&1&&N(j,1)):(j=St(E),j.c(),N(j,1),j.m(h,c)):j&&(Ct(),F(j,1,1,()=>{j=null}),jt()),(!q||R&1)&&g!==(g=E[1].venue_name+"")&&Oe(w,g),E[1].venue_address?I?I.p(E,R):(I=Et(E),I.c(),I.m(u,null)):I&&(I.d(1),I=null)},i(E){q||(N(j),N(d.$$.fragment,E),q=!0)},o(E){F(j),F(d.$$.fragment,E),q=!1},d(E){E&&m(e),U&&U.d(),j&&j.d(),X(d),I&&I.d()}}}function ci(n){let e,t,s="Come see us play!",r,i,a,o=at(n[0]),l=[];for(let c=0;c<o.length;c+=1)l[c]=Ot(Tt(n,o,c));const h=c=>F(l[c],1,1,()=>{l[c]=null});return{c(){e=T("div"),t=T("h3"),t.textContent=s,r=L(),i=T("div");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){e=x(c,"DIV",{class:!0});var u=y(e);t=x(u,"H3",{"data-svelte-h":!0}),se(t)!=="svelte-1w4n38e"&&(t.textContent=s),r=D(u),i=x(u,"DIV",{class:!0});var d=y(i);for(let f=0;f<l.length;f+=1)l[f].l(d);d.forEach(m),u.forEach(m),this.h()},h(){p(i,"class","w-full flex flex-col gap-8"),p(e,"class","w-full items-center flex flex-col gap-20 px-12")},m(c,u){M(c,e,u),v(e,t),v(e,r),v(e,i);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(i,null);a=!0},p(c,[u]){if(u&1){o=at(c[0]);let d;for(d=0;d<o.length;d+=1){const f=Tt(c,o,d);l[d]?(l[d].p(f,u),N(l[d],1)):(l[d]=Ot(f),l[d].c(),N(l[d],1),l[d].m(i,null))}for(Ct(),d=o.length;d<l.length;d+=1)h(d);jt()}},i(c){if(!a){for(let u=0;u<o.length;u+=1)N(l[u]);a=!0}},o(c){l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)F(l[u]);a=!1},d(c){c&&m(e),qt(l,c)}}}function hi(n,e,t){let{gigs:s=[]}=e;return n.$$set=r=>{"gigs"in r&&t(0,s=r.gigs)},[s]}class ui extends G{constructor(e){super(),K(this,e,hi,ci,V,{gigs:0})}}function di(n){let e,t='<div class="w-full aspect-video bg-slate-600"></div> <div class="w-full flex gap-6"><div class="w-1/3 flex flex-col gap-6"><div class="w-full aspect-square bg-slate-600"></div> <div class="w-full aspect-square bg-slate-600"></div></div> <div class="w-1/3 flex flex-col gap-6"><div class="w-full aspect-[4/3] bg-slate-600"></div> <div class="w-full aspect-[4/3] bg-slate-600"></div> <div class="w-full aspect-[4/3] bg-slate-600"></div></div> <div class="w-1/3 flex flex-col gap-6"><div class="w-full aspect-square bg-slate-600"></div> <div class="w-full aspect-square bg-slate-600"></div></div></div>';return{c(){e=T("div"),e.innerHTML=t,this.h()},l(s){e=x(s,"DIV",{class:!0,"data-svelte-h":!0}),se(e)!=="svelte-10w74cj"&&(e.innerHTML=t),this.h()},h(){p(e,"class","w-full flex flex-col gap-6 px-12")},m(s,r){M(s,e,r)},p:S,i:S,o:S,d(s){s&&m(e)}}}class fi extends G{constructor(e){super(),K(this,e,null,di,V,{})}}function gi(n){let e,t,s,r,i,a,o,l,h,c,u,d,f,_;return t=new Xr({}),i=new ei({}),o=new si({}),h=new ii({}),u=new ui({props:{gigs:n[0]}}),f=new fi({}),{c(){e=T("div"),W(t.$$.fragment),s=L(),r=T("div"),W(i.$$.fragment),a=L(),W(o.$$.fragment),l=L(),W(h.$$.fragment),c=L(),W(u.$$.fragment),d=L(),W(f.$$.fragment),this.h()},l(g){e=x(g,"DIV",{class:!0});var w=y(e);Y(t.$$.fragment,w),s=D(w),r=x(w,"DIV",{class:!0});var b=y(r);Y(i.$$.fragment,b),a=D(b),Y(o.$$.fragment,b),l=D(b),Y(h.$$.fragment,b),c=D(b),Y(u.$$.fragment,b),d=D(b),Y(f.$$.fragment,b),b.forEach(m),w.forEach(m),this.h()},h(){p(r,"class","w-9/12 z-10 flex flex-col items-center gap-32"),p(e,"class","w-screen flex flex-col items-center")},m(g,w){M(g,e,w),Q(t,e,null),v(e,s),v(e,r),Q(i,r,null),v(r,a),Q(o,r,null),v(r,l),Q(h,r,null),v(r,c),Q(u,r,null),v(r,d),Q(f,r,null),_=!0},p(g,[w]){const b={};w&1&&(b.gigs=g[0]),u.$set(b)},i(g){_||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(o.$$.fragment,g),N(h.$$.fragment,g),N(u.$$.fragment,g),N(f.$$.fragment,g),_=!0)},o(g){F(t.$$.fragment,g),F(i.$$.fragment,g),F(o.$$.fragment,g),F(h.$$.fragment,g),F(u.$$.fragment,g),F(f.$$.fragment,g),_=!1},d(g){g&&m(e),X(t),X(i),X(o),X(h),X(u),X(f)}}}function pi(n,e,t){let s=[];const r=Nr("https://qfgdyglnzabvqvnwzbgy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFmZ2R5Z2xuemFidnF2bnd6Ymd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTU2MzUzMjUsImV4cCI6MjAxMTIxMTMyNX0.-__xDA5DIoBNTLvYQLVo1RnpjplE5oXgWulgZ1pBWME"),i=async()=>{let{data:a,error:o}=await r.from("gigs").select("*");return o&&console.error("Error fetching gigs:",o),a};return Ft(async()=>{t(0,s=await i()),console.log("Fetched gigs:",s)}),[s]}class wi extends G{constructor(e){super(),K(this,e,pi,gi,V,{})}}export{wi as component};
